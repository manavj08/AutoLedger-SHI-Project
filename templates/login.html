<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login Portal</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: #f0f2f5; display:flex; justify-content:center; align-items:center; height:100vh; margin: 0;}
    .login-container { background:white; padding:40px; border-radius:12px; box-shadow:0 5px 15px rgba(0,0,0,0.1); width:100%; max-width: 360px; text-align:center; }
    h2 { margin-bottom:25px; color: #333; }
    .form-group { margin-bottom:20px; text-align: left; }
    label { display:block; margin-bottom:8px; font-weight: 600; color: #555;}
    input, select { width:100%; padding:12px; border:1px solid #ccc; border-radius:8px; box-sizing: border-box; transition: border-color 0.2s; }
    input:focus, select:focus { border-color: #4CAF50; outline: none; }
    button { width:100%; padding:12px; background:#4CAF50; color:white; border:none; border-radius:8px; cursor:pointer; font-size: 16px; font-weight: bold; transition: background-color 0.2s; }
    button:hover { background:#45a049; }
    .links { margin-top:20px; }
    .links a { text-decoration:none; color:#007bff; }
  </style>
</head>
<body>
  <div class="login-container">
    <h2>Login</h2>
    <!-- Added an ID to the form for JavaScript -->
    <form id="login-form">
      <div class="form-group">
        <label for="username">Username:</label>
        <input type="text" id="username" name="username" required>
      </div>
      <div class="form-group">
        <label for="password">Password:</label>
        <input type="password" id="password" name="password" required>
      </div>
      <div class="form-group">
        <label for="role">I am a:</label>
        <select id="role" name="role" required>
            <option value="" disabled selected>-- Select your role --</option>
            <option value="student">Student</option>
            <option value="employee">Employee</option>
            <option value="shopkeeper">Shopkeeper</option>
        </select>
      </div>
      <button type="submit">Login</button>
      <div class="links">
        <a href="/register">Don't have an account? Register</a>
      </div>
    </form>
  </div>

  <!-- JAVASCRIPT FOR POP-UP AND LOGIN -->
  <script>
    const loginForm = document.getElementById('login-form');

    loginForm.addEventListener('submit', async function(event) {
        // 1. Prevent the page from reloading
        event.preventDefault();

        // 2. Collect the form data
        const formData = new FormData(loginForm);

        try {
            // 3. Send the data to the Flask server
            const response = await fetch('/login_user', {
                method: 'POST',
                body: formData
            });

            // 4. Get the JSON response back from the server
            const result = await response.json();

            // 5. Show the pop-up alert with the server's message
            alert(result.message);

            // 6. If the 'success' field in the JSON is true, redirect the page
            if (result.success) {
                window.location.href = result.redirect_url;
            }

        } catch (error) {
            console.error('Login Error:', error);
            alert('A network or server error occurred. Please try again.');
        }
    });
  </script>
</body>
</html>